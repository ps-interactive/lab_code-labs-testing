<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>CSRF Vulnerable Transfer Form</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <header>
        <h1>Premier Auctions</h1>
        <nav>
            <a href="/">Home</a>
        </nav>
    </header>
    
    <div class="container">
        <h2>Money Transfer System</h2>
        
        <div class="alert alert-info" th:if="${message}">
            <p th:text="${message}"></p>
        </div>
        
        <div class="row mt-4">
            <div class="col">
                <div class="item-detail-container">
                    <h3>Legitimate Money Transfer Form</h3>
                    <p>This is a legitimate form on the trusted website.</p>
                    
                    <form th:action="@{/transfer-vulnerable}" method="post" class="mb-4">
                        <!-- No CSRF token here - vulnerable! -->
                        <div class="form-group">
                            <label for="recipient">Recipient:</label>
                            <input type="text" id="recipient" name="recipient" value="Friend" required>
                        </div>
                        <div class="form-group">
                            <label for="amount">Amount ($):</label>
                            <input type="number" id="amount" name="amount" value="100" min="1" required>
                        </div>
                        <div class="mt-3">
                            <button type="submit" class="btn btn-primary">Transfer Money</button>
                        </div>
                    </form>
                    
                    <div class="alert alert-warning">
                        ⚠️ This form is vulnerable to CSRF attacks because:
                        <ul>
                            <li>It uses HTTP POST (state-changing operation)</li>
                            <li>Spring Security's CSRF protection is disabled (csrf().disable())</li>
                            <li>No custom CSRF token is implemented</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="col">
                <div class="item-detail-container">
                    <h3>Malicious Site</h3>
                    <p>This simulates an attacker's website with a hidden form.</p>
                    
                    <div style="background-color: #ffcccc; padding: 15px; border: 1px solid #ff8888; border-radius: 0.25rem;">
                        <h3>Cute Kittens Website</h3>
                        <p>Click the button to see cute kittens!</p>
                        
                        <!-- Hidden malicious form -->
                        <form id="evil-form" th:action="@{/transfer-vulnerable}" method="post" style="display: none;">
                            <input type="hidden" name="recipient" value="Attacker">
                            <input type="hidden" name="amount" value="1000">
                        </form>
                        
                        <button onclick="document.getElementById('evil-form').submit();" class="btn btn-danger">
                            Show me cute kittens!
                        </button>
                        
                        <p class="mt-2"><small>What this actually does: submits a hidden form that transfers $1000 to "Attacker"</small></p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="item-detail-container mt-4">
            <h2>How to Fix CSRF Vulnerabilities:</h2>
            <ol>
                <li>
                    <strong>Enable Spring Security's CSRF Protection</strong>
                    <pre style="background-color: #f8f9fa; padding: 10px; border-radius: 0.25rem;">
// Do NOT use this in your configuration:
http.csrf().disable()

// Instead, let Spring Security handle CSRF protection by default:
http.authorizeHttpRequests(...) // without disabling CSRF
                    </pre>
                </li>
                <li>
                    <strong>Use Thymeleaf's CSRF integration</strong>
                    <pre style="background-color: #f8f9fa; padding: 10px; border-radius: 0.25rem;">
&lt;form th:action="@{/transfer}" method="post"&gt;
    &lt;!-- Thymeleaf automatically adds CSRF token when Spring Security is configured properly --&gt;
    &lt;input type="text" name="recipient"&gt;
    &lt;input type="number" name="amount"&gt;
    &lt;button type="submit"&gt;Transfer&lt;/button&gt;
&lt;/form&gt;
                    </pre>
                </li>
                <li>
                    <strong>Custom CSRF Implementation (if not using Spring Security)</strong>
                    <pre style="background-color: #f8f9fa; padding: 10px; border-radius: 0.25rem;">
// Generate token and store in session
String csrfToken = generateRandomToken();
session.setAttribute("CSRF_TOKEN", csrfToken);

// Add to form and validate on submission
&lt;input type="hidden" name="csrf_token" value="${csrfToken}"&gt;

// Validate token when processing form submission
if (!request.getParameter("csrf_token").equals(session.getAttribute("CSRF_TOKEN"))) {
    // Invalid token, reject request
}
                    </pre>
                </li>
            </ol>
        </div>
        
        <div class="mt-4 mb-4">
            <a th:href="@{/}" class="btn btn-primary">Back to Home</a>
        </div>
    </div>
</body>
</html>